<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>课堂</title>
</head>

<body>
    <div id="app">
    </div>
</body>
<script>
    console.log("-------分割线---------");
    // 1.promise 实例
    const pro = new Promise(function (resolve, reject) {
        setTimeout(() => {
            // let data = "今天星期五"
            // resolve(data)

            let data = "马上可以休息了"
            reject(data)

        }, 1000);
    })
    /* pro.then(res=>{
        console.log(res,"成功的回调");
    }).catch(err=>{
        console.log(err,"失败的回调");
    }) */

    // 简写形式
    pro.then(
        (res) => {
            console.log(res);
        },
        (err) => {
            console.log(err);
        }
    )

    /* const pro = new Promise(function (resolve,reject) {
        setTimeout(() => {
            let data = "今天星期五"
            resolve(data)

            let data = "马上可以休息了"
            reject(data)

        }, 1000);
    })
    pro.then(res=>{
        console.log(res,"成功的回调");
    }).catch(err=>{
        console.log(err,"失败的回调");
    })

    pro.then(
        (res)=>{
            console.log(res);
        },
        (err)=>{
            console.log(err);
        }
    ) */

    /* const pro = new Promise(function (resolve,reject) {
        setTimeout(() => {
            let data = "今天星期五"
            resolve(data)

            let data = "马上可以休息了"
            reject(data)

        }, 1000);
    })
    pro.then(res=>{
        console.log(res,"成功的回调");
    }).catch(err=>{
        console.log(err,"失败的回调");
    })

    pro.then(
        (res)=>{
            console.log(res);
        },
        (err)=>{
            console.log(err);
        }
    ) */

    console.log("-------分割线---------");
    // 2.promise 实例2
    const pro1 = new Promise(function (resolve, reject) {
        setTimeout(() => {
            let data = "数据库中的用户数据"

            console.log("-------分割线---------");
            // resolve(data)

            let err = "数据读取失败"
            reject(err)
        }, 1000);
    })

    pro1.then(
        (value) => {
            console.log(value);
        },
        (reason) => {
            console.log(reason);
        }
    )

    /* const pro1 = new Promise(function (resolve, reject) {
        setTimeout(() => {
            let data = "数据库中的用户数据"

            console.log("-------分割线---------");
            resolve(data)

            let err = "数据读取失败"
            reject(err)
        }, 1000);
    })

    pro1.then(
        (value) => {
            console.log(value);
        },
        (reason) => {
            console.log(reason);
        }
    ) */

    /* const pro1 = new Promise(function (resolve, reject) {
        setTimeout(() => {
            let data = "数据库中的用户数据"

            console.log("-------分割线---------");
            resolve(data)

            let err = "数据读取失败"
            reject(err)
        }, 1000);
    })

    pro1.then(
        (value) => {
            console.log(value);
        },
        (reason) => {
            console.log(reason);
        }
    ) */


    console.log("-------分割线---------");
    // 3.封装promise函数获取数据的js

    // 写在js文件中
    /* const fs = require("fs")

    // 调用方法读取文件
    // fs.readFile("./文本.md",(err,data)=>{
    //     if (err) {
    //         throw err
    //     }
    //     console.log(data.toString());
    // })

    const pro2 = new Promise(function (resolve, reject) {
        fs.readFile("./文本.md", (err, data) => {
            if (err) {
                reject(err)
            }
            resolve(data)
        })
    })

    pro2.then(res => {
        console.log(res.toString());
    }).catch(err => {
        // console.log(111);
        console.log("读取失败");
    }) */


    // 4.promise 封装ajax

    // 实例化promise函数
    const pro3 = new Promise(function (resolve, reject) {
        // 创建xhr对象
        var xhr = new XMLHttpRequest()

        // 确定请求方法和接口
        xhr.open("GET", "https://api.apiopen.top/getJoke")

        // 发送
        xhr.send()

        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr >= 200 && xhr.status < 300) {
                    // 200-299 表示成功
                    resolve(xhr.response)
                } else {
                    // 表示失败
                    reject(xhr.status)
                }
            }
        }
    })

    pro3.then(res => {
            console.log(res);
        },
        (err) => {
            console.log(err);
        }
    )

    /* const pro = new Promise(function (resolve, reject) {
        var xhr = new XMLHttpRequest()
        xhr.open("GET", "https://api.apiopen.top/getJoke")
        xhr.send()
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr >= 200 && xhr.status < 300) {
                    // 200-299 表示成功
                    resolve(xhr.response)
                } else {
                    // 表示失败
                    reject(xhr.status)
                }
            }
        }
    })

    pro.then(res => {
            console.log(res);
        },
        (err) => {
            console.log(err);
        }
    ) */

    /* const pro = new Promise(function (resolve, reject) {
        var xhr = new XMLHttpRequest()
        xhr.open("GET", "https://api.apiopen.top/getJoke")
        xhr.send()
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr >= 200 && xhr.status < 300) {
                    // 200-299 表示成功
                    resolve(xhr.response)
                } else {
                    // 表示失败
                    reject(xhr.status)
                }
            }
        }
    })

    pro.then(res => {
            console.log(res);
        },
        (err) => {
            console.log(err);
        }
    ) */

    
    console.log("-------分割线---------");
    // 5.promise的then 方法

    const pro4 = new Promise(function (resolve, reject) {
        setTimeout(() => {
            resolve("promise的then方法")
        }, 1000);
    })

    const result = pro4.then(value=>{
        console.log(value);
        return "这是return的数据"

        // return new Pormise((resolve,reject)=>{
        //     reject("error")
        // })

        // throw ("出错")


    },reason=>{
        console.warn(reason);
    })

    console.log(result,"result");
    result.then(res=>{
        console.log(res);
    })

    /* const pro4 = new Promise(function (resolve, reject) {
        setTimeout(() => {
            resolve("promise的then方法")
        }, 1000);
    })
    const result = pro4.then(value=>{
        console.log(value);
        return "这是return的数据"
        return new Pormise((resolve,reject)=>{
            reject("error")
        })
    },reason=>{
        console.warn(reason);
    })
    console.log(result,"result");
    result.then(res=>{
        console.log(res);
    }) */

    /* const pro4 = new Promise(function (resolve, reject) {
        setTimeout(() => {
            resolve("promise的then方法")
        }, 1000);
    })
    const result = pro4.then(value=>{
        console.log(value);
        return "这是return的数据"
        return new Pormise((resolve,reject)=>{
            reject("error")
        })
    },reason=>{
        console.warn(reason);
    })
    console.log(result,"result");
    result.then(res=>{
        console.log(res);
    }) */






</script>

</html>